<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>Formation Arduino : Part 1</title><meta name="generator" content="Hovercraft! 1.0 http://regebro.github.com/hovercraft"></meta><link rel="stylesheet" href="css/hovercraft.css" media="all"></link><link rel="stylesheet" href="css/impressConsole.css" media="all"></link><link rel="stylesheet" href="css/highlight.css" media="all"></link><link rel="stylesheet" href="css/style.css" media="screen,projection"></link></head><body class="impress-not-supported"><div id="impress" data-transition-duration="1000"><div class="step" step="0" data-x="0" data-y="0"><h1 id="formation-arduino">Formation Arduino</h1></div><div class="step" step="1" data-x="1600" data-y="0"><h1 id="partie-0-les-outils-pour-programmer">Partie 0 : les outils pour programmer !</h1></div><div class="step" step="2" id="sect_outils" data-x="3200" data-y="0"><h1 id="ide-arduino">IDE Arduino</h1><img src="imgs/IDE.png" alt="" width="600px" height=""></img><p>Disponible pour Windows, Linux, MacOS</p><p><a href="http://arduino.cc">http://arduino.cc</a></p></div><div class="step" step="3" data-x="4800" data-y="0"><h1 id="ide-web">IDE web</h1><img src="imgs/codebender.png" alt="" width="600px" height=""></img><p><a href="http://codebender.cc">http://codebender.cc</a></p><p>Juste un plug-in &#xE0; installer dans son navigateur (FF &amp; Chrome/Chromium)</p></div><div class="step" step="4" data-x="6400" data-y="0"><h1 id="partie-1-bases">Partie 1 : Bases !</h1></div><div class="step" step="5" data-y="1600" data-x="6400" id="sect_structure"><h1 id="structure-d-un-programme">Structure d'un programme</h1><p>Depuis la version 1 : programmes en <tt>.ino</tt></p></div><div class="step" step="6" data-y="1600" data-x="8000"><h1 id="declarations"># D&#xE9;clarations</h1><pre class="highlight code c"><span class="cp">#define FOO 42          </span><span class="c1">// define, macros
</span><span class="cp">#include "stuff.h"      </span><span class="c1">// fichier du projet
</span><span class="cp">#include &lt;DmxSimple.h&gt;  </span><span class="c1">// lib
</span></pre><ul><li>&#xE9;valu&#xE9;es &#xE0; la compilation (et remplac&#xE9;s)</li></ul></div><div class="step" step="7" data-x="9600" data-y="1600"><h1 id="setup">setup()</h1><pre class="highlight code c"><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// init ....
</span><span class="p">}</span></pre><p>Initialisation du programme</p><ul><li>d&#xE9;claration des entr&#xE9;e/sorties (E/S)</li><li>interruptions</li><li>variables globales</li><li>tout pour mettre en marche...</li></ul></div><div class="step" step="8" data-x="11200" data-y="1600"><h1 id="loop">loop()</h1><pre class="highlight code c"><span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// init ....
</span><span class="p">}</span></pre><p>Le programme en lui m&#xEA;me : fonction principale.</p><p>Elle boucle ind&#xE9;finiment....</p><pre class="highlight ">Pour toujours...
    loop()</pre></div><div class="step" step="9" data-x="12800" data-y="1600"><h1 id="premier-programme">Premier programme</h1><pre class="highlight code c"><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// init...
</span><span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// programme...
</span><span class="p">}</span></pre><p>Un programme (inutile mais) fonctionnel...</p></div><div class="step" step="10" id="sect_sorties_num" data-y="3200" data-x="12800"><h1 id="entrees-et-sorties-numeriques">Entr&#xE9;es et Sorties Num&#xE9;riques</h1><img src="imgs/sorties_num/entre_sorties.png" alt="" width="600px" height=""></img></div><div class="step" step="11" data-x="12800" data-y="4800"><h1 id="sorties-numeriques">Sorties Num&#xE9;riques</h1><img src="imgs/sorties_num/carte_arduino.png" alt="" width="600px" height=""></img></div><div class="step" step="12" data-y="4800" data-x="14400"><h1 id="pinmode">pinMode()</h1><p>Une broche peut &#xEA;tre en entr&#xE9;e ou sortie...</p><p>il faut choisir au d&#xE9;marrage du programme (<tt>setup()</tt>)</p><pre class="highlight code c"><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{}</span></pre></div><div class="step" step="13" data-x="16000" data-y="4800"><h1 id="constantes">Constantes</h1><p>Arduino propose des constantes</p><ul><li>modes<blockquote><ul><li><tt>OUTPUT</tt></li><li><tt>INPUT</tt></li><li><tt>INPUT_PULLUP</tt></li></ul></blockquote></li><li>niveaux<blockquote><ul><li><tt>HIGH</tt></li><li><tt>LOW</tt></li></ul></blockquote></li><li>des raccourcis...<blockquote><ul><li><tt>LED_BUILTIN</tt></li><li><tt>true</tt></li><li><tt>false</tt></li></ul></blockquote></li></ul></div><div class="step" step="14" data-x="17600" data-y="4800"><h1 id="allumer-une-led">Allumer une LED</h1><div class="notes"><p>lancer un bout d'exo pour allumer la LED</p></div></div><div class="step" step="15" data-x="19200" data-y="4800"><h1 id="solution">Solution :)</h1><pre class="highlight code c"><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
<span class="p">}</span></pre></div><div class="step" step="16" data-x="20800" data-y="4800"><h1 id="pour-deux-instructions">Pour deux instructions...</h1><h2 id="digitalwrite">digitalWrite()</h2><ul><li>permet <em>"d'&#xE9;crire"</em> un niveau logique sur une sortie</li><li>active <span class="i">imm&#xE9;diatement</span> la sortie au niveau demand&#xE9;</li></ul><h2 id="delay-t">delay(t)</h2><ul><li>permet d'attendre un temps t... <span class="i">en millisecondes</span> !</li><li>pendant ce temps l&#xE0;, l'arduino ne fait <span class="i">rien d'autre</span> !</li></ul></div><div class="step" step="17" data-x="22400" data-y="4800"><h1 id="faire-clignoter-la-led">Faire clignoter la LED</h1><p>... le <em>hello world</em> en &#xE9;lectronique...</p><div class="notes"><p>encore un exo</p></div></div><div class="step" step="18" data-x="24000" data-y="4800"><h1 id="id1">Solution :)</h1><pre class="highlight code c"><span class="cp">#define TEMPS 1000
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="n">TEMPS</span><span class="p">);</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="n">TEMPS</span><span class="p">);</span>
<span class="p">}</span></pre></div><div class="step" step="19" data-y="6400" data-x="24000"><h1 id="boucles-simples">Boucles simples</h1></div><div class="step" step="20" data-y="6400" data-x="25600"><h1 id="conditions">Conditions</h1><ul><li>Tout ce qui n'est pas 0 est vrai</li></ul><pre class="highlight code c"><span class="nb">true</span> <span class="o">||</span> <span class="nb">true</span> <span class="c1">// true
</span><span class="nb">true</span> <span class="o">||</span> <span class="nb">false</span> <span class="c1">// true
</span><span class="nb">false</span> <span class="o">||</span> <span class="nb">false</span> <span class="c1">// false
</span>
<span class="nb">true</span> <span class="o">&amp;&amp;</span> <span class="nb">true</span> <span class="c1">// true
</span><span class="nb">true</span> <span class="o">&amp;&amp;</span> <span class="nb">false</span> <span class="c1">// false
</span><span class="nb">false</span> <span class="o">&amp;&amp;</span> <span class="nb">false</span> <span class="c1">// false
</span>
<span class="o">!</span><span class="nb">true</span> <span class="c1">// false</span></pre><div class="notes"><p>distributif, communatif</p></div></div><div class="step" step="21" data-x="27200" data-y="6400"><h1 id="variables">Variables</h1><ul><li>D&#xE9;finir des noms pour y mettre des valeurs :</li></ul><pre class="highlight code c"><span class="c1">// premier exemple : l'entier
</span><span class="kt">int</span> <span class="n">foo</span> <span class="o">=</span> <span class="mi">42</span><span class="p">;</span>

<span class="c1">// pour les autres on verra plus tard.
</span></pre></div><div class="step" step="22" data-x="28800" data-y="6400"><h1 id="operations-operateurs">Op&#xE9;rations, Op&#xE9;rateurs</h1><h2 id="maths">Maths</h2><pre class="highlight code c"><span class="o">=</span>       <span class="c1">// assignation
</span><span class="o">-</span> <span class="o">+</span> <span class="o">*</span>   <span class="c1">// vous connaissez...
</span><span class="o">/</span>       <span class="c1">// division enti&#xE8;re
</span><span class="o">%</span>       <span class="c1">// reste de la division enti&#xE8;re
</span><span class="o">--</span> <span class="o">++</span>   <span class="c1">// d&#xE9;cr&#xE9;ment/incr&#xE9;ment</span></pre><h2 id="logiques">Logiques</h2><pre class="highlight code c"><span class="o">==</span>      <span class="c1">// &#xE9;galit&#xE9;
</span><span class="o">!=</span>      <span class="c1">// diff&#xE9;rent
</span><span class="o">&lt;</span> <span class="o">&gt;</span>     <span class="c1">// inf&#xE9;rieur/sup&#xE9;rieur
</span><span class="o">&gt;=</span> <span class="o">&lt;=</span>   <span class="c1">// inf/sup ou &#xE9;gal</span></pre></div><div class="step" step="23" data-x="30400" data-y="6400"><h1 id="while">While</h1><blockquote><p>Tant que je gagne, je joue ! &#x2015; Coluche</p></blockquote><pre class="highlight code c"><span class="k">while</span> <span class="p">(</span><span class="n">je</span> <span class="n">gagne</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// je joue
</span><span class="p">}</span>

<span class="c1">// -- Arduino</span></pre><ul><li>faire quelque chose tant qu'une condition est vraie...</li><li>ou infiniment si la condition est toujours vraie (<tt>true</tt>)</li></ul></div><div class="step" step="24" data-x="32000" data-y="6400"><h1 id="faire-clignoter-une-led-10-fois">Faire clignoter une LED 10 fois</h1></div><div class="step" step="25" data-x="33600" data-y="6400"><h1 id="id2">Solution</h1><pre class="highlight code c"><span class="cp">#define NB 10       </span><span class="c1">// nombre de blinks
</span><span class="cp">#define TEMPS 1000  </span><span class="c1">// intervales
</span>
<span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">NB</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
        <span class="n">delay</span><span class="p">(</span><span class="n">TEMPS</span><span class="p">);</span>
        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
        <span class="n">delay</span><span class="p">(</span><span class="n">TEMPS</span><span class="p">);</span>
        <span class="n">i</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div><div class="step" step="26" data-y="8000" data-x="33600"><h1 id="fonctions-procedures">Fonctions/Proc&#xE9;dures</h1><img src="imgs/fonctions.png" alt="" width="600px" height=""></img></div><div class="step" step="27" data-y="8000" data-x="35200"><h1 id="concept">Concept</h1><ul><li>bout de programme d&#xE9;sign&#xE9; par un nom</li><li>peut recevoir des param&#xE8;tres en entr&#xE9;e</li><li>peut renvoyer une valeur</li></ul><h1 id="variables-et-fonctions">Variables et fonctions</h1><ul><li>les variables d&#xE9;finies dans les fonctions ne sont accessible <span class="i">que dedans</span></li><li>les variables d&#xE9;finies en dehors de toute fonction sont accessibles <span class="i">partout</span></li></ul></div><div class="step" step="28" data-x="36800" data-y="8000"><h1 id="syntaxe-generale">Syntaxe g&#xE9;n&#xE9;rale</h1><pre class="highlight code c"><span class="o">&lt;</span><span class="n">type</span> <span class="n">de</span> <span class="n">retour</span><span class="o">&gt;</span> <span class="n">nom_de_la_fonction</span> <span class="p">(</span><span class="n">type1</span><span class="p">,</span> <span class="n">param1</span><span class="p">,</span> <span class="n">etc</span><span class="p">...)</span> <span class="p">{</span>
    <span class="c1">// code
</span><span class="p">}</span>

<span class="c1">// pour une proc&#xE9;dure (sans retour)
</span><span class="kt">void</span> <span class="n">fonction</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// code
</span><span class="p">}</span>

<span class="c1">// retour d'un entier :
</span><span class="kt">int</span> <span class="n">fonction</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// code
</span>    <span class="k">return</span> <span class="n">un_truc</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// +42
</span><span class="kt">int</span> <span class="n">plus42</span><span class="p">(</span><span class="kt">int</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">n</span><span class="o">+</span><span class="mi">42</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span></pre></div><div class="step" step="29" data-x="38400" data-y="8000"><h1 id="blink-en-fonction">Blink en fonction !</h1></div><div class="step" step="30" data-x="40000" data-y="8000"><h1 id="id3">Solution</h1><pre class="highlight code c"><span class="cp">#define LED 13
#define TEMPS 1000
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">blink</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">blink</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="n">TEMPS</span><span class="p">);</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="n">TEMPS</span><span class="p">);</span>
<span class="p">}</span></pre></div><div class="step" step="31" data-x="41600" data-y="8000"><h1 id="parametrer-le-temps-d-allumage">Param&#xE8;trer le temps d'allumage</h1></div><div class="step" step="32" data-x="43200" data-y="8000"><h1 id="id4">Solution</h1><pre class="highlight code c"><span class="cp">#define LED 13
#define TEMPS 500
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">LED</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">blink</span><span class="p">(</span><span class="n">TEMPS</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">blink</span><span class="p">(</span><span class="kt">int</span> <span class="n">temps</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="n">temps</span><span class="p">);</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="n">temps</span><span class="p">);</span>
<span class="p">}</span></pre></div><div class="step" step="33" data-y="9600" data-x="43200"><h1 id="conditionnelles">Conditionnelles</h1></div><div class="step" step="34" data-y="9600" data-x="44800"><h1 id="et-si">Et si ?</h1><pre class="highlight code c"><span class="k">if</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// fait un truc
</span><span class="p">}</span></pre><h1 id="et-sinon">Et sinon ?</h1><pre class="highlight code c"><span class="k">if</span> <span class="p">(</span><span class="n">condition</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// fait un truc
</span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// sinon...
</span>    <span class="c1">// ou un autre
</span><span class="p">}</span></pre></div><div class="step" step="35" data-x="46400" data-y="9600"><h1 id="on-en-chaine">On (en)chaine !</h1><pre class="highlight code c"><span class="k">if</span> <span class="p">(</span><span class="n">condition</span> <span class="n">A</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// truc A
</span><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">condition</span> <span class="n">B</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// truc B
</span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// sinon
</span>    <span class="c1">// truc C
</span><span class="p">}</span></pre></div><div class="step" step="36" data-y="11200" data-x="46400"><h1 id="entrees-numeriques">Entr&#xE9;es num&#xE9;riques</h1><p>(<em>digital</em> chez les anglais...)</p></div><div class="step" step="37" data-y="11200" data-x="48000" id="pullup"><h1 id="generalites">G&#xE9;n&#xE9;ralit&#xE9;s</h1><ul><li>m&#xEA;mes ports que les sorties num&#xE9;riques</li><li>choix de la "fonction" entr&#xE9;e avec <tt>pinMode</tt> et <tt>INPUT</tt></li><li>l'entr&#xE9;e &#xE0; deux niveaux : <tt>HIGH</tt> et <tt>LOW</tt></li></ul><h1 id="input-pullup">INPUT_PULLUP ?</h1><img src="imgs/pullup.png" alt="" width="200px" height=""></img><p>Permet de mettre une entr&#xE9;e au niveau <span class="i">haut</span> si l'interrupteur est <strong>ouvert</strong> !</p><p>Sur Arduino la r&#xE9;sistance de <span class="i">pull-up est interne</span>. Sur certains microcontr&#xF4;lleurs, on peut aussi choisir d'activer un
pull-down.</p></div><div class="step" step="38" data-x="49600" data-y="11200"><h1 id="exemples">Exemples</h1><pre class="highlight code c"><span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">INPUT</span><span class="p">);</span> <span class="c1">// input standard
</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">INPUT_PULLUP</span><span class="p">);</span> <span class="c1">// entr&#xE9;e "tir&#xE9;e"
</span><span class="p">}</span></pre></div><div class="step" step="39" data-x="51200" data-y="11200"><h1 id="push-to-blink">Push-to-blink</h1><p>La LED clignote <strong>si</strong> le bouton est enfonc&#xE9; !</p></div><div class="step" step="40" data-x="52800" data-y="11200"><h1 id="id5">Solution</h1><pre class="highlight code c"><span class="cp">#define BP 2 </span><span class="c1">// bp sur l'entr&#xE9;e 2
</span><span class="cp">#define TEMPS 250
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">BP</span><span class="p">,</span> <span class="n">INPUT_PULLUP</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">BP</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">blink</span><span class="p">(</span><span class="n">TEMPS</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">blink</span><span class="p">(</span><span class="kt">int</span> <span class="n">temps</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="n">temps</span><span class="p">);</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_BUILTIN</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
    <span class="n">delay</span><span class="p">(</span><span class="n">temps</span><span class="p">);</span>
<span class="p">}</span></pre></div><div class="step" step="41" data-x="54400" data-y="11200"><h1 id="double-blink">Double blink</h1><p>Deux boutons activent la LED, &#xE0; <span class="i">deux fr&#xE9;quences diff&#xE9;rentes</span>.</p></div><div class="step" step="42" data-x="56000" data-y="11200"><h1 id="id6">Solution</h1><pre class="highlight code c"><span class="c1">// TODO
</span></pre></div><div class="step" step="43" data-x="57600" data-y="11200"><h1 id="toggle-to-shine">Toggle-to-shine</h1><p>Un premi&#xE8;re appui allume la LED, un second l'&#xE9;teint.</p></div><div class="step" step="44" data-x="59200" data-y="11200"><h1 id="id7">Solution</h1><pre class="highlight code c"><span class="k">const</span> <span class="kt">int</span> <span class="n">PB_PIN</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// BP connect&#xE9; pin 2
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">LED_PIN</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="c1">// onboard LED on pin 13
</span><span class="n">boolean</span> <span class="n">ledOn</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// Drapeau de l'etat de la LED
</span>
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Configuration des broches d'E/S
</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">PB_PIN</span><span class="p">,</span> <span class="n">INPUT_PULLUP</span><span class="p">);</span> <span class="c1">// internal pull-up
</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">PB_PIN</span><span class="p">)</span> <span class="o">==</span> <span class="n">LOW</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// on change l'etat de la led
</span>        <span class="n">ledOn</span> <span class="o">=</span> <span class="o">!</span><span class="n">ledOn</span><span class="p">;</span>
        <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">ledOn</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></pre><p>Seulement, &#xE7;a ne marche pas tr&#xE8;s bien... pourquoi ?</p></div><div class="step" step="45" id="bouncing" data-x="60800" data-y="11200"><h1 id="anti-rebond">Anti-rebond</h1><img src="imgs/antirebond.png" alt="" width="300px" height=""></img><p>Probl&#xE8;me : comment prendre en compte seulement le premier contact ?</p></div><div class="step" step="46" data-x="62400" data-y="11200"><pre class="highlight code c"><span class="k">const</span> <span class="kt">int</span> <span class="n">PB_PIN</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">// BP connect&#xE9; pin 2
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">LED_PIN</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span> <span class="c1">// onboard LED sur pin 13
</span><span class="k">const</span> <span class="kt">int</span> <span class="n">TRANSIENT_PERIOD</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// P&#xE9;riode transitoire (ms)
</span><span class="n">boolean</span> <span class="n">transientPeriodStarted</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// Drapeau "d&#xE9;but du basculement du BP"
</span><span class="n">boolean</span> <span class="n">ledOn</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span> <span class="c1">// Drapeau "&#xE9;tat de la LED"
// indicateur de traitement du basculement de bouton d&#xE9;but&#xE9;
</span><span class="n">boolean</span> <span class="n">bPressAccepted</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="c1">// Pour enregistrer le temps de demarrage du basculement
</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">timeRef</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Configuration des broches d'E/S
</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">PB_PIN</span><span class="p">,</span> <span class="n">INPUT_PULLUP</span><span class="p">);</span> <span class="c1">// internal pull-up
</span>    <span class="n">pinMode</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">digitalRead</span><span class="p">(</span><span class="n">PB_PIN</span><span class="p">)</span> <span class="o">==</span> <span class="n">LOW</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">transientPeriodStarted</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// si c'est le 1er passage a Zero
</span>            <span class="n">transientPeriodStarted</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">//on l'indique
</span>            <span class="n">timeRef</span> <span class="o">=</span> <span class="n">millis</span><span class="p">();</span> <span class="c1">// et on prend la ref&#xE9;rence de temps
</span>        <span class="p">}</span>
        <span class="c1">// si la periode du d&#xE9;lais d'attente est pass&#xE9;e
</span>        <span class="c1">// et que le BP n'est pas encore consid&#xE9;r&#xE9; comme appuy&#xE9;
</span>        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">bPressAccepted</span> <span class="o">&amp;&amp;</span>
            <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">)(</span><span class="n">millis</span><span class="p">()</span> <span class="o">-</span> <span class="n">timeRef</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">TRANSIENT_PERIOD</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">ledOn</span> <span class="o">=</span> <span class="o">!</span><span class="n">ledOn</span><span class="p">;</span> <span class="c1">// on change l'etat de la led
</span>            <span class="n">digitalWrite</span><span class="p">(</span><span class="n">LED_PIN</span><span class="p">,</span> <span class="n">ledOn</span><span class="p">);</span>

            <span class="n">bPressAccepted</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// et on enregistre l'appuis sur le BP
</span>        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span> <span class="c1">// BP relach&#xE9; -&gt; on remet a 0 tout les indicateurs
</span>        <span class="n">transientPeriodStarted</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
        <span class="n">bPressAccepted</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></pre></div><div class="step" step="47" data-x="64000" data-y="11200"><h1 id="plus-simple">Plus simple ?</h1><p>Le code est lourd non ?</p><p>Il doit y avoir plus simple...</p></div><div class="step" step="48" data-y="12800" data-x="64000"><h1 id="interruptions">Interruptions</h1></div><div class="step" step="49" data-y="12800" data-x="65600"><h1 id="id8">Concept</h1><ul><li>Permet de prendre en compte imm&#xE9;diatement un &#xE9;v&#xE8;nement.</li><li>On <span class="i">attache</span> une routine d'interruption &#xE0; une entr&#xE9;e...</li><li>Sur Arduino, on a le choix entre les entr&#xE9;es 2 et 3 : on les appelle 0 et 1...</li><li>On utilise la fonction <tt>attachInterrupt(pin, routine, mode)</tt></li><li>4 modes diff&#xE9;rents :<blockquote><ul><li><tt>LOW</tt></li><li><tt>CHANGE</tt> : trig. &#xE0; chaque changement de niveau</li><li><tt>RISING</tt> : trig. sur front montant</li><li><tt>FALLING</tt> : trig. sur front descendant</li></ul></blockquote></li><li>on ne peut utiliser <span class="i">que des variables volatile</span></li></ul><div class="notes"><p>"Les variables partag&#xE9;es entre les fonction standard et les ISR (Routine de service d'interruption) doivent &#xEA;tre
d&#xE9;clar&#xE9;es "volatile". Cela explique au compilateur que ce genre de variable peut changer &#xE0; tout moment et qu'il
doit la recharger &#xE0; chaque fois quelle est r&#xE9;f&#xE9;renc&#xE9;e, plutot que de se contenter d'une copie trouv&#xE9;e dans un registre processeur."</p></div></div><div class="step" step="50" data-x="67200" data-y="12800"><h1 id="interruptions-exemple">Interruptions : Exemple</h1><pre class="highlight code c"><span class="kt">int</span> <span class="n">pin</span> <span class="o">=</span> <span class="mi">13</span><span class="p">;</span>
<span class="k">volatile</span> <span class="kt">int</span> <span class="n">state</span> <span class="o">=</span> <span class="n">LOW</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">pinMode</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
    <span class="n">attachInterrupt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">blink</span><span class="p">,</span> <span class="n">CHANGE</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">digitalWrite</span><span class="p">(</span><span class="n">pin</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">blink</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">state</span> <span class="o">=</span> <span class="o">!</span><span class="n">state</span><span class="p">;</span>
<span class="p">}</span></pre><p>Simple non?</p></div></div><div id="hovercraft-help" class="hide"><table><tr><th>Space</th><td>Forward</td></tr><tr><th>Right, Down, Page Down</th><td>Next slide</td></tr><tr><th>Left, Up, Page Up</th><td>Previous slide</td></tr><tr><th>P</th><td>Open presenter console</td></tr><tr><th>H</th><td>Toggle this help</td></tr></table></div><script type="text/javascript" src="js/impress.js"></script><script type="text/javascript" src="js/impressConsole.js"></script><script type="text/javascript" src="js/hovercraft.js"></script></body></html>